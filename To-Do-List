import os
import json

arquivo_tarefas = "tarefas.json"
tarefas = {}

def carregar_tarefas():
    global tarefas
    if os.path.exists(arquivo_tarefas):
        with open(arquivo_tarefas, "r", encoding="utf-8") as arquivo:
            tarefas = json.load(arquivo)
    else:
        tarefas = {}

def salvar_tarefas():
    with open(arquivo_tarefas, "w", encoding="utf-8") as arquivo:
        json.dump(tarefas, arquivo, indent=4, ensure_ascii=False)
        # dump é pra colocar coisa no arquivo

def adicionar_tarefa():
    tarefa = input("Digite a tarefa: ").strip()
    if tarefa:
        tarefas[tarefa] = {"feito": False}
        salvar_tarefas()
        print("Tarefa adicionada com sucesso!")
    else:
        print("Tarefa inválida, tente novamente.")

def listar_tarefas():
    if not tarefas:
        print("Nenhuma tarefa na lista.")
    else:
        print("\n--- Lista de Tarefas ---")
        for i, (tarefa, dados) in enumerate(tarefas.items(), 1):
            status = "(feito)" if dados["feito"] else "(não feito)"
            print(f"{i}. {status} - {tarefa}")

def remover_tarefa():
    listar_tarefas()
    if tarefas:
        try:
            num = int(input("Digite o número da tarefa que deseja remover: "))
            if 1 <= num <= len(tarefas):
                chave = list(tarefas.keys())[num - 1]
                tarefas.pop(chave)
                salvar_tarefas()
                print(f"Tarefa '{chave}' removida com sucesso!")
            else:
                print("Número inválido.")
        except ValueError:
            print("Digite um número válido.")

def alternar_status_tarefa():
    listar_tarefas()
    if tarefas:
        try:
            num = int(input("Digite o número da tarefa que deseja marcar/desmarcar: "))
            if 1 <= num <= len(tarefas):
                chave = list(tarefas.keys())[num - 1]
                tarefas[chave]["feito"] = not tarefas[chave]["feito"]
                salvar_tarefas()
                
                status = "feita" if tarefas[chave]["feito"] else "não feita"
                print(f"Tarefa '{chave}' marcada como {status}!")
            else:
                print("Número inválido.")
        except ValueError:
            print("Digite um número válido.")

# Carrega as tarefas salvas antes de começar
carregar_tarefas()

while True:
    print("\nEscolha uma opção:")
    print("1. Adicionar tarefa")
    print("2. Listar tarefas")
    print("3. Remover tarefa")
    print("4. Alternar status (feito/não feito)")
    print("5. Sair")

    opcao = input("Opção: ")

    if opcao == '1':
        adicionar_tarefa()
    elif opcao == '2':
        listar_tarefas()
    elif opcao == '3':
        remover_tarefa()
    elif opcao == '4':
        alternar_status_tarefa()
    elif opcao == '5':
        print("Saindo do programa...")
        break
    else:
        print("Opção inválida, tente de novo.")

